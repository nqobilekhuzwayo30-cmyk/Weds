<!DOCTYPE html>
<html>
<head>
  <title>Wedding Seating</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body { font-family: Arial; text-align: center; padding: 20px; background-color: #f7f5f2; }
    h2 { font-size: 28px; margin-bottom: 20px; }
    input, button {
      padding: 10px;
      font-size: 16px;
      margin: 10px 0;
      border-radius: 6px;
      border: 1px solid #ccc;
    }
    button {
      background-color: #d8b384;
      color: white;
      border: none;
      cursor: pointer;
    }
    button:hover {
      background-color: #cfa16c;
    }
    table { margin: 20px auto; border-collapse: collapse; width: 90%; max-width: 400px; background-color: #fff; }
    td, th { border: 1px solid #ccc; padding: 12px; text-align: left; }
    th { background-color: #d8b384; color: white; }
  </style>
</head>
<body>

<h2>Your Seating Assignment</h2>
<p>Enter your 10-digit phone number to view your seating assignment:</p>
<input type="text" id="phoneInput" placeholder="0623832721" maxlength="10">
<button onclick="findSeating()">Check Seating</button>

<div id="seating"></div>

<script src="https://cdn.jsdelivr.net/npm/tabletop@1.6.0/src/tabletop.min.js"></script>
<script>
  var publicSpreadsheetUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vT7EuVjq6Jf1xdvEOjkBU7fkBV1PyUs7uiBKSPX77dV_pZ17k-ehTQjViqvvRGTxviTtesxg2pow_r9/pubhtml';
  var sheetData = [];

  function normalizePhone(p) { return p.replace(/[^0-9]/g,''); }

  function displaySeating(row) {
    var container = document.getElementById('seating');
    var tableHTML = '<table>';
    tableHTML += '<tr><th>Field</th><th>Info</th></tr>';
    tableHTML += '<tr><td>Name</td><td>' + row.Name + '</td></tr>';
    tableHTML += '<tr><td>Phone</td><td>' + row.Phone + '</td></tr>';
    tableHTML += '<tr><td>Guests</td><td>' + row.Guests + '</td></tr>';
    tableHTML += '<tr><td>Table</td><td>' + (row.Table || 'Not assigned yet') + '</td></tr>';
    tableHTML += '</table>';
    container.innerHTML = tableHTML;
  }

  function findSeating() {
    var input = normalizePhone(document.getElementById('phoneInput').value.trim());
    var container = document.getElementById('seating');
    container.innerHTML = '';

    if (!/^\d{10}$/.test(input)) {
      container.innerText = 'Please enter a valid 10-digit phone number.';
      return;
    }

    var row = sheetData.find(r => {
      var phone = normalizePhone(r.Phone);
      // Convert +27 or 27 prefix to 0 for matching
      if(phone.length === 12 && phone.startsWith("27")) phone = "0" + phone.slice(2);
      if(phone.length === 11 && phone.startsWith("27")) phone = "0" + phone.slice(2);
      return phone === input;
    });

    if (!row) {
      container.innerText = 'No seating information found for this phone number.';
      return;
    }

    displaySeating(row);
  }

  function init() {
    Tabletop.init({
      key: publicSpreadsheetUrl,
      simpleSheet: true,
      callback: function(data) { sheetData = data; },
      error: function() { document.getElementById('seating').innerText = 'Error loading seating data.'; }
    });
  }

  window.addEventListener('DOMContentLoaded', init);
</script>

</body>
</html>
